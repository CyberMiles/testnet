<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CyberMiles Travis TestNet Faucet</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/style.css">

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-51595858-19', 'auto');
      ga('send', 'pageview');
    </script>

  </head>
  <body>
  <nav>
    <a href="https://www.cybermiles.io">
      <img class="logo" src="https://www.cybermiles.io/static/91d939dee4ec371960d8046a9009d6c4/06142/cybermilesLogo.png" alt="CyberMiles logo" />
    </a>
    <div class="links">
      <a href="/cn/">中文（简体）</a>
    </div>
  </nav>
  <div id="map"></div>
  <div class="container">
    <h1>CyberMiles Travis TestNet Faucet</h1>
    <div class="box" id="status-box">
      <p class="lead text-center">Blockchain Status: <span id="status">Fetching data ...</span></p>
    </div>

    <h2>Get started</h2>
    <p>To get Travis TestNet CMT (the native token) and TEST (a test contract token based on CMT) tokens, you will need to first create accounts on the blockchain. There are two ways to do this. You can start your own Travis node, or apply access to one of our nodes.</p>

    <ul>
      <li><a href="https://medium.com/cybermiles/running-a-travis-node-ac7447b754d4">Start your own Travis node</a> (recommended)</li>
      <li>Or alternatively, <a href="https://medium.com/cybermiles/travis-testnet-testing-guide-c7687b6f4f82">Access one of our nodes</a></li>
    </ul>
    
    <a href="https://medium.com/cybermiles/introducing-travis-the-cybermiles-testnet-2f9a981e560">Learn more about CyberMiles Travis TestNet</a>

    <h2>Get some tokens</h2>
    <p>Please use the form below to send some tokens to your newly created wallet.</p>

    <form method=POST>
      <div class="form-group">
        <label for="to">Account</label>
        <input type="text" class="form-control" name="to" id="to" placeholder="0x">
      </div>
      <div class="g-recaptcha" data-sitekey="6Le6wFIUAAAAAPMm9nXPFR9h6gL8HRD21GpQaJxT"></div>
      <div class="control-group" style="margin-top:10px;">
        <button type="button">Send me 1000 CMT and 1000 TEST </button>
      </div>
    </form>

    <h2>TestNet State</h2>
    <p><strong>Genesis Block Time</strong>: 2018-09-17T02:29:01.452942965Z</p>
    <p><strong>Source Code Commit Hash</strong>: 096932caec31f3f8951e0c3197d00cb053529132</p>

    
    <h2>What's next?</h2>
    <p>Next, please follow the TestNet Guides to continue your tests!</p>
    
  </div>

  <div class="footer">
    <p class="lead text-center">Happy testing!</p>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
if (typeof jQuery == 'undefined') {
  setTimeout(function() {
    alert('The page is not loaded properly, please refresh and try again.')
  }, 1000)
}
$(document).ready(function(){
  $.ajax({
    url: "http://travis-node.cybermiles.io:26657/status",
    dataType: 'json',
    error: function(){
      $('#status-box').css('background', 'rgba(216, 0, 0, 0.1)');
      $('#status').css('color', 'rgb(193, 0, 8)');
      $('#status').html("Down (please check back later)");
    },
    success: function(json_x){
      if (json_x.error) {
        $('#status-box').css('background', 'rgba(216, 0, 0, 0.1)');
        $('#status').css('color', 'rgb(193, 0, 8)');
        $('#status').html("Error: " + json_x.error);
      } else {
        $('#status-box').css('background', 'rgba(30, 186, 0, 0.1)');
        $('#status').css('color', 'rgb(19, 122, 0)');
        $('#status').html("Last block: " + json_x.result.sync_info.latest_block_height);
      }
    },
    timeout: 5000
  });
});
  </script>

  <script>
function initMap() {
  var styledMapType = new google.maps.StyledMapType(
    [
      {
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#1d2c4d"
          }
        ]
      },
      {
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#8ec3b9"
          }
        ]
      },
      {
        "elementType": "labels.text.stroke",
        "stylers": [
          {
            "color": "#1a3646"
          }
        ]
      },
      {
        "featureType": "administrative",
        "elementType": "geometry",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "administrative.country",
        "elementType": "geometry.stroke",
        "stylers": [
          {
            "color": "#4b6878"
          }
        ]
      },
      {
        "featureType": "administrative.land_parcel",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "administrative.land_parcel",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#64779e"
          }
        ]
      },
      {
        "featureType": "administrative.neighborhood",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "administrative.province",
        "elementType": "geometry.stroke",
        "stylers": [
          {
            "color": "#4b6878"
          }
        ]
      },
      {
        "featureType": "landscape.man_made",
        "elementType": "geometry.stroke",
        "stylers": [
          {
            "color": "#334e87"
          }
        ]
      },
      {
        "featureType": "landscape.natural",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#023e58"
          }
        ]
      },
      {
        "featureType": "poi",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "poi",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#283d6a"
          }
        ]
      },
      {
        "featureType": "poi",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#6f9ba5"
          }
        ]
      },
      {
        "featureType": "poi",
        "elementType": "labels.text.stroke",
        "stylers": [
          {
            "color": "#1d2c4d"
          }
        ]
      },
      {
        "featureType": "poi.park",
        "elementType": "geometry.fill",
        "stylers": [
          {
            "color": "#023e58"
          }
        ]
      },
      {
        "featureType": "poi.park",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#3C7680"
          }
        ]
      },
      {
        "featureType": "road",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "road",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#304a7d"
          }
        ]
      },
      {
        "featureType": "road",
        "elementType": "labels",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "road",
        "elementType": "labels.icon",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "road",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#98a5be"
          }
        ]
      },
      {
        "featureType": "road",
        "elementType": "labels.text.stroke",
        "stylers": [
          {
            "color": "#1d2c4d"
          }
        ]
      },
      {
        "featureType": "road.highway",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#2c6675"
          }
        ]
      },
      {
        "featureType": "road.highway",
        "elementType": "geometry.stroke",
        "stylers": [
          {
            "color": "#255763"
          }
        ]
      },
      {
        "featureType": "road.highway",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#b0d5ce"
          }
        ]
      },
      {
        "featureType": "road.highway",
        "elementType": "labels.text.stroke",
        "stylers": [
          {
            "color": "#023e58"
          }
        ]
      },
      {
        "featureType": "transit",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "transit",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#98a5be"
          }
        ]
      },
      {
        "featureType": "transit",
        "elementType": "labels.text.stroke",
        "stylers": [
          {
            "color": "#1d2c4d"
          }
        ]
      },
      {
        "featureType": "transit.line",
        "elementType": "geometry.fill",
        "stylers": [
          {
            "color": "#283d6a"
          }
        ]
      },
      {
        "featureType": "transit.station",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#3a4762"
          }
        ]
      },
      {
        "featureType": "water",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#0e1626"
          }
        ]
      },
      {
        "featureType": "water",
        "elementType": "labels.text",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "featureType": "water",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#4e6d70"
          }
        ]
      }
    ],
    {name: 'Styled Map'}
  );
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 2,
    center: {lat: 20, lng: 0},
    mapTypeControl: false,
    streetViewControl: false
  });

  map.mapTypes.set('styled_map', styledMapType);
  map.setMapTypeId('styled_map');

  getNodes(map)

}

function getNodes(map) {
  $.ajax({
    url: "/nodes",
    type: 'post',
    dataType: 'json',
    error: function(){
    },
    success: function(json_x){
      if (!json_x.error) {
        var markers = []
        for (var i in json_x) {
          var node = json_x[i]
          markers.push(new google.maps.Marker({
            position: {lat: node.ll[0], lng: node.ll[1]},
            icon: {
              path: google.maps.SymbolPath.CIRCLE,
              fillColor: 'HotPink',
              fillOpacity: 1,
              strokeOpacity: 0,
              scale: 13
            },
            label: '1',
            title: node.city ? ('Node in ' + node.city) : ''
          }))
        }

        new MarkerClusterer(map, markers, {imagePath: '/images/m'});
      }
    },
    timeout: 5000
  });
}
</script>
  <script src="markerclusterer.js"></script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAY5reA8YKj3QlLsfot7EDqXDMV76p3aXw&callback=initMap"></script>

  <script src='https://www.google.com/recaptcha/api.js'></script>

  <script>
var addReg = /^0[xX][0-9a-zA-Z]{40}/g
if (typeof recaptcha == 'undefined') {
  $('<p class="help-block"></p>').insertAfter('#to').text('Loading Google Recaptcha...')
  var intv = setInterval(function() {
    if (typeof recaptcha != 'undefined') {
      clearInterval(intv)
      $('#to').siblings('.help-block').remove()
    }
  }, 500)
}
$('form button').click(function() {
  if (typeof window.recaptcha == 'undefined') {
    $('<p class="help-block error"></p>').insertAfter('#to').text('Google Recaptcha not loaded. Please wait or refresh the page.')
    return false
  }
  $('#to').siblings('.help-block').remove()
  addReg.lastIndex = 0
  if (!addReg.test($('#to').val())) {
    $('<p class="help-block error"></p>').insertAfter('#to').text('Please enter a valid address')
    return false
  }
  var recaptcha = grecaptcha.getResponse()
  if (!recaptcha) {
    $('<p class="help-block error"></p>').insertAfter('#to').text('Please verify the recaptcha')
    return false
  }
  $('form').find('input, button').prop('disabled', true)
  $.ajax({
    url: '/send',
    type: 'post',
    dataType: 'json',
    contentType:"application/json; charset=utf-8",
    data: JSON.stringify({to: $('#to').val(), recaptcha: recaptcha}),
    error: () => {
      $('<p class="help-block error"></p>').insertAfter('#to').text('Error occured')
    },
    success: (data) => {
      if (data.error) {
        var failed = 'Failed'
        if (typeof data.error == 'string') {
          failed = data.error
        }
        $('<p class="help-block error"></p>').insertAfter('#to').text(failed)
      } else if (data.cmtHash) {
        $('<p class="help-block success"></p>').insertAfter('#to').html('Success with transaction hash<br/>CMT - ' + data.cmtHash + '<br/>TEST - ' + data.testHash)
      }
    },
    complete: () => {
      $('form').find('input, button').prop('disabled', false)
      grecaptcha.reset()
    }
  })
  return false
})
  </script>

  </body>
</html>
